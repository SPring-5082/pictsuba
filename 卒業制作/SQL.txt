CREATE TABLE CUSTOMERS(
	CUSTOMER_ID INT AUTO_INCREMENT PRIMARY KEY,
	NAME VARCHAR(32) NOT NULL,
	PASSWORD VARCHAR(64) NOT NULL,
	PHONE VARCHAR(16) UNIQUE,
	MAIL VARCHAR(32) NOT NULL UNIQUE,
	AGE INT NOT NULL CHECK(AGE >= -1),
	BIRTH_DAY DATE,
	GENDER VARCHAR(8),
	POINT INT NOT NULL CHECK(POINT >= 0) DEFAULT 0,
	FIRST_LOG DATE NOT NULL,
	FIN_LOG DATE NOT NULL,
	CHECK(FIRST_LOG <= FIN_LOG)
);



CREATE TABLE ADDRESS(
	ADDRESS_ID INT AUTO_INCREMENT PRIMARY KEY,
	CUSTOMER_ID INT REFERENCES CUSTOMERS(CUSTOMER_ID),
	ZIP_CODE VARCHAR(8) NOT NULL CHECK( LENGTH(ZIP_CODE) = 7 OR LENGTH(ZIP_CODE) = 8 ),
	PREF VARCHAR(8) NOT NULL,
	MUNICIPALITIES VARCHAR(32) NOT NULL,
	STREET VARCHAR(32) NOT NULL,
	BUILDING VARCHAR(64) 
);



CREATE TABLE CREDIT_CARDS(
	CARD_ID INT AUTO_INCREMENT  PRIMARY KEY,
	CUSTOMER_ID INT NOT NULL REFERENCES CUSTOMERS(CUSTOMER_ID),
	NUMBER VARCHAR(16) NOT NULL,
	EXPIRE VARCHAR(8) NOT NULL,
	SECURITY_CODE INT NOT NULL,
	OWNER_NAME VARCHAR(32) NOT NULL
);



ALTER TABLE CUSTOMERS ADD (ADDRESS_ID INT REFERENCES ADDRESS(ADDRESS_ID));
ALTER TABLE CUSTOMERS ADD (CARD_ID INT REFERENCES CREDIT_CARDS(CARD_ID));



CREATE TABLE CREATORS(
	CREATOR_ID INT AUTO_INCREMENT PRIMARY KEY,
	CREATOR_NAME VARCHAR(64) NOT NULL UNIQUE,
	POPULARITY INT NOT NULL DEFAULT 0
);



CREATE TABLE CATEGORIES(
	CATEGORY_ID INT AUTO_INCREMENT PRIMARY KEY,
	CATEGORY_NAME VARCHAR(32) NOT NULL,
	LARGE_CATEGORY_ID INT REFERENCES CATEGORIES(CATEGORY_ID)
);



CREATE TABLE PRODUCTS(
	PRODUCT_ID INT AUTO_INCREMENT PRIMARY KEY,
	PRODUCT_NAME VARCHAR(128) NOT NULL,
	ADD_DATE DATE NOT NULL DEFAULT (CURRENT_DATE()),
	PRICE INT NOT NULL CHECK(PRICE > 0),
	CREATOR_ID INT NOT NULL REFERENCES CREATORS(CREATOR_ID),
	CATEGORY_ID INT NOT NULL REFERENCES CATEGORIES(CATEGORY_ID),
	STOCK INT NOT NULL CHECK(STOCK >= 0) DEFAULT 0,
	LOOKUP 	INT NOT NULL CHECK(LOOKUP >= 0) DEFAULT 0,
	POINT INT NOT NULL CHECK(POINT >= 0),
	IMAGE VARCHAR(64) NOT NULL,
	DESCRYPTION VARCHAR(1024),
	UNIQUE(PRODUCT_NAME,CREATOR_ID)
);



CREATE TABLE ORDERS(
	ORDER_ID INT NOT NULL,
	CUSTOMER_ID INT NOT NULL REFERENCES CUSTOMERS(CUSTOMER_ID),
	PRODUCT_ID INT NOT NULL REFERENCES PRODUCTS(PRODUCT_ID),
	QUANTITY INT NOT NULL CHECK(QUANTITY > 0),
    PRICE INT NOT NULL CHECK(PRICE > 0),
	ADDRESS_ID INT NOT NULL REFERENCES ADDRESS(ADDRESS_ID),
	ORDER_DATE DATE NOT NULL DEFAULT (CURRENT_DATE()),
	STATE VARCHAR(32) NOT NULL,
	UNIQUE(ORDER_ID,PRODUCT_ID)
);



CREATE TABLE ORDER_HISTORIES(
	ORDER_HISTORY_ID INT NOT NULL,
	CUSTOMER_ID INT NOT NULL REFERENCES CUSTOMERS(CUSTOMER_ID),
	PRODUCT_ID INT NOT NULL REFERENCES PRODUCTS(PRODUCT_ID),
	QUANTITY INT NOT NULL CHECK(QUANTITY > 0),
    PRICE INT NOT NULL CHECK(PRICE > 0),
	ADDRESS_ID INT NOT NULL REFERENCES ADDRESS(ADDRESS_ID),
	ORDER_DATE DATE NOT NULL,
	UNIQUE(ORDER_HISTORY_ID,PRODUCT_ID)
);



CREATE TABLE FAVORITES(
	CUSTOMER_ID INT NOT NULL REFERENCES CUSTOMERS(CUSTOMER_ID),
	PRODUCT_ID INT NOT NULL REFERENCES PRODUCTS(PRODUCT_ID),
	UNIQUE(CUSTOMER_ID,PRODUCT_ID)
);



CREATE TABLE CART(
	CUSTOMER_ID INT REFERENCES CUSTOMERS(CUSTOMER_ID),
    PRODUCT_ID INT REFERENCES PRODUCTS(PRODUCT_ID),
    QUANTITY INT NOT NULL CHECK(QUANTITY > 0),
    PRIMARY KEY(CUSTOMER_ID,PRODUCT_ID)
);



CREATE TABLE ADVERTISEMENTS(
	ADVERTISEMENT_ID INT AUTO_INCREMENT PRIMARY KEY,
    ADVERTISEMENT_NAME VARCHAR(64) NOT NULL,
	URL VARCHAR(128) NOT NULL
);

CREATE TABLE CONTACTS(
 	CONTACT_ID INT AUTO_INCREMENT PRIMARY KEY,
 	NAME VARCHAR(64) NOT NULL,
 	MAIL VARCHAR(32) NOT NULL,
 	MESSAGE VARCHAR(4096) NOT NULL
);

